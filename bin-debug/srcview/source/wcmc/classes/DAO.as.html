<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>DAO.as</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre>
<span class="ActionScriptpackage">package</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptComment">// this is the package information
</span><span class="ActionScriptBracket/Brace">{</span>
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FeatureSet</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MapPoint</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tasks</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">QueryTask</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tasks</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">supportClasses</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Query</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Event</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">net</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">URLLoader</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">net</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">URLRequest</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">flash</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Dictionary</span>;
    
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">collections</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ArrayCollection</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">controls</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Alert</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">core</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">UIComponent</span>;
    <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rpc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncResponder</span>;
    <span class="ActionScriptASDoc">/**
     * Singleton class that provides non-spatial data access objects to the UI layer. This class is used extensively by the CSN class to retrieve species, sites, IBA, IWC and other data from the server. The class uses a combination of methods to retrieve the data but the most widely used is to
     * execute an asynchronous request to a REST endpoint (using ArcGIS Server 10) and to retrieve the results in a function enclosed in the same block. The results of this asynchronous return call are delivered back to the UI using a set of custom Event classes. 
     * @author andrewcottam
     * 
     */</span>
        <span class="ActionScriptReserved">public</span> <span class="ActionScriptclass">class</span> <span class="ActionScriptDefault_Text">DAO</span> <span class="ActionScriptReserved">extends</span> <span class="ActionScriptDefault_Text">UIComponent</span>
        <span class="ActionScriptBracket/Brace">{</span>
        <span class="ActionScriptASDoc">/**
         * Dispatched when a data request is completed. The data can be retrieved from the results property.
         */</span>        
            <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Event</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"dataRetrieved"</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">type</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"wcmc.classes.AGSResult"</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">]</span>
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">DAO</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>
            <span class="ActionScriptBracket/Brace">{</span>
            <span class="ActionScriptBracket/Brace">}</span>
    <span class="ActionScriptASDoc">/**
     * Return species information for the passed SpcRecIDs. StronglyTypedReturn determines the return type of the items in the arraycollection - if true then the arraycollection will be populated with species class objects  
     * @param commonNameField The name of the commonNameField to return. The actual field that is returned will depend on the language for the current application.
     * @param SpcRecIDs If this parameter is null then all species are returned; if this parameter is a single value then a single species is returned; if this value is an array then multiple species are returned.
     * @param stronglyTypedReturn If this is true then the results will be strongly typed (i.e. instances of the Species class).
     * 
     */</span>
    <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getSpecies</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">commonNameField</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">SpcRecIDs</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">stronglyTypedReturn</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Species/MapServer/5"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//'Species data' table
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"*"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">SpcRecIDs</span><span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SpcRecID&gt;-1"</span>; <span class="ActionScriptComment">//get info for all species    
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SpcRecIDs</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">==</span>1<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SpcRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">SpcRecIDs</span>; <span class="ActionScriptComment">//get info for one species
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">inClause</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">createSpeciesInClause</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SpcRecIDs</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get info for a array of species - this array will come from an array of lookup values from a filter - so the SpcRecID property is 'id'
</span>                        <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SpcRecID In ("</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">inClause</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">")"</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//execute the query
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attributes</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">stronglyTypedReturn</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">species</span>:<span class="ActionScriptDefault_Text">Species</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">populateSpeciesObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">commonNameField</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//create the stronglt typed array collection
</span>                            <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">species</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">else</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sortOn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"commonName"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//sort the species on the common name field
</span>                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SPECIES</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//dispatch the event to pass the data back to the UI
</span>                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns the Waterbird Population Estimates for a species. 
             * @param SpcRecID The species ID.
             * @return An array collection of the population estimates.
             * 
             */</span>    
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getWaterbirdPopulationEstimates</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SpcRecID</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Species/MapServer/6"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//'Flyway population estimates' 
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"*"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SpcRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">SpcRecID</span>;
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attributes</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sortOn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"flyway"</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">WPE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_ac</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns an individual site feature using the passed site object. 
             * @param site The site object to retrieve.
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getSiteFeature</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">site</span>:<span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">site</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isPoly</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Sites/MapServer/1"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//'Site polygons' layer
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Sites/MapServer/0"</span><span class="ActionScriptBracket/Brace">)</span>;    <span class="ActionScriptComment">//'Site points' layer
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ibaQuery</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">ibaQuery</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
                    <span class="ActionScriptDefault_Text">ibaQuery</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"Name"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptString">"SiteRecID"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptString">"CountryCode"</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">ibaQuery</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">siteRecID</span>;
                    <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ibaQuery</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">features</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SITE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns non-spatial information for a site. This is used if the sites page is called directly.
             * @param SiteRecIDs The siteRecID of the site to find.
             * @param searchText If set the query will also search for a site which contains the searchText.
             * @return 
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getSite</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SiteRecIDs</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">searchText</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Sites/MapServer/9"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//'Sites data' table
</span>                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">showBusyCursor</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">true</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"*"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">SiteRecIDs</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteRecID&gt;-1"</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SiteRecIDs</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">","</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteRecID In ("</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">SiteRecIDs</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">")"</span>:    <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">SiteRecIDs</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">searchText</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">" and name like '%"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">searchText</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"%'"</span>;
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attributes</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">site</span>:<span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">populateSiteObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">site</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sortOn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"sortNo"</span><span class="ActionScriptOperator">,</span><span class="ActionScriptString">"name"</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">,</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">NUMERIC</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CASEINSENSITIVE</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SITE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_ac</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns the IWC counts for the passed site code and species. 
             * @param siteCode The IWC sitecode to search on. 
             * @param spcRecID The species ID to search on.
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCountsForIWC</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">siteCode</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">spcRecID</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Sites/MapServer/10"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// 'IWC counts' table
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"*"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">siteCode</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">search</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">","</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteCode In ("</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">siteCode</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">") and SpcRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">spcRecID</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteCode='"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">siteCode</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"' and SpcRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">spcRecID</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">allCounts</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//all counts - i.e. could have many counts for 1 year from lots of sites
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">yearCounts</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span>; <span class="ActionScriptComment">//counts summarised by year
</span>                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attributes</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">speciesCount</span>:<span class="ActionScriptDefault_Text">SpeciesCount</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">populateSpeciesCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">,</span><span class="ActionScriptString">"SiteCode"</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">allCounts</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">speciesCount</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">yearCounts</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getYearCounts</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">allCounts</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//summarise the counts by year
</span>                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IWCCOUNTS</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">yearCounts</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns a species list for a site. 
             * @param commonNameField The common name field to be used for retrieving the species names. 
             * @param siteRecID The site to retrieve a species list for.
             * @return 
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getSpeciesListForSite</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">commonNameField</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">siteRecID</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Sites/MapServer/11"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// 'Site CSN Data' table
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"*"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">siteRecID</span>;
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attributes</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sortOn</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Species"</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">refresh</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SITESPECIESLIST</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_ac</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns a flyways list for a point. 
             * @param commonNameField The common name field to be used for retrieving the species names. 
             * @param mapPoint The mapPoint where the user clicked.
             * @return 
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getFlywaysForPoint</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">commonNameField</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">mapPoint</span>:<span class="ActionScriptDefault_Text">MapPoint</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Reports/MapServer/0"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// 'Species for a point report' layer
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"SpcFlyRecID"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">mapPoint</span>;
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getFlywayIDs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">POINTFLYWAYSLIST</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns a set of SpcFlyRecIDs for a country 
             * @param countryID The countryID for the country 
             * @param justSpcFlyRecIDs If true only return the SpcFlyRecIDs
             * @return 
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getFlywaysForCountry</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">countryID</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Reports/MapServer/5"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// 'Flyway Countries' layer
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"CountryID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">countryID</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"SpcFlyRecID"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getFlywayIDs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">COUNTRYFLYWAYSLIST</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getFlywayIDs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attributes</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SpcFlyRecID</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">ac</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns the IWC site codes that match the passed site. 
             * @param siteRecID The siteRecID of the site to search for.
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getIWCSiteCodesForSiteRecID</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">siteRecID</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">queryTask</span>:<span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">QueryTask</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/ArcGIS/rest/services/CSN/Sites/MapServer/4"</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">// 'IWC Points' layer
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">query</span>:<span class="ActionScriptDefault_Text">Query</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Query</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">returnGeometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">false</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">outFields</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"SiteCode"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">where</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">"SiteRecID="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">siteRecID</span>;
                <span class="ActionScriptDefault_Text">queryTask</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">execute</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">query</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">featureSet</span>:<span class="ActionScriptDefault_Text">FeatureSet</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">featureSet</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">attributes</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">AGSResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IWCSITECODES</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Populates a strongly typed species object with data from an asynhronous return call 
             * @param commonNameField The name of the field for the common name
             * @param object The object containing the data to populated the species with.
             * @return The species object.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">populateSpeciesObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">commonNameField</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Species</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">species</span>:<span class="ActionScriptDefault_Text">Species</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Species</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">species</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">commonName</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">commonNameField</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">species</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">englishCommonName</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"NameEN"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">species</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">spcRecID</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SpcRecID</span>;
                <span class="ActionScriptDefault_Text">species</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">scientificName</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Species</span>;
                <span class="ActionScriptDefault_Text">species</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">spcRedCategory</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SpcRedCategory</span>;
                <span class="ActionScriptDefault_Text">species</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">aewaID</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AEWAId</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">species</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Populates a strongly typed site object with data from an asynhronous return call 
             * @param object The object containing the data to populated the site with.
             * @return The site object.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">populateSiteObject</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Site</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">site</span>:<span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">countryCode</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Country</span>;
                <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isPoly</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">IsPoly</span>;
                <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Name</span>;
                <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">siteRecID</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SiteRecID</span>;
                <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sortNo</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SortNo</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">site</span>;                
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Populates a strongly typed species count object with data from an asynhronous return call 
             * @param object The object containing the data to populated the site with.
             * @param SiteCodeField The name of the field that holds the site code.
             * @return The speciesCount object.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">populateSpeciesCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">SiteCodeField</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">SpeciesCount</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">speciesCount</span>:<span class="ActionScriptDefault_Text">SpeciesCount</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SpeciesCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">speciesCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">siteCode</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">SiteCodeField</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">speciesCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">spcRecID</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SpcRecID</span>;
                <span class="ActionScriptDefault_Text">speciesCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abundance</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Count_</span>;
                <span class="ActionScriptDefault_Text">speciesCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_year</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">object</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Year</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">speciesCount</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Utility function to format a percentage value. 
             * @param percentNumber The percentage value as a number
             * @return A formatted percentage string.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptReserved">static</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getPercent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">percentNumber</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">percentNumber</span><span class="ActionScriptOperator">&gt;</span>1<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">percentNumber</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toFixed</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"%"</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptString">"&lt;1%"</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Utility function which adds up all species counts by year. 
             * @param counts An ArrayCollection of counts for a species.
             * @return An ArrayCollection of species counts that have been totalled for each year.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getYearCounts</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">counts</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span> <span class="ActionScriptComment">//adds up species counts by year
</span>            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">totals</span>:<span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//create a dictionary as a simple hash table to store each years data
</span>                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">count</span>:<span class="ActionScriptDefault_Text">SpeciesCount</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">counts</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">totals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_year</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">totals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_year</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abundance</span> : <span class="ActionScriptDefault_Text">totals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_year</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abundance</span>; <span class="ActionScriptComment">//create an entry for each year and as you iterate through the counts, add the counts on to existing years
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">yearCounts</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">array</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getUniqueDictionaryKeys</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">totals</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get the unique year values from the dictionary
</span>                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">Year</span>:<span class="ActionScriptDefault_Text">Object</span>;
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">number</span>:<span class="ActionScriptDefault_Text">Number</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">array</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//iterate through each of the unique years and create a yearCount for each year
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">Year</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getDictionaryItemWithKey</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">totals</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">number</span><span class="ActionScriptBracket/Brace">)</span>; 
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">yearCount</span>:<span class="ActionScriptDefault_Text">SpeciesCount</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SpeciesCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">yearCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_year</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Year</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">yearCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abundance</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">totals</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">Year</span><span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptDefault_Text">yearCounts</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yearCount</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">yearCounts</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Iterates through the keys for the dictionary and builds an array of all of the keys and sorts them 
             * @param dictionary The dictionary to get unique values from.
             * @return An array of unique values.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getUniqueDictionaryKeys</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dictionary</span>:<span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Array</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">array</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">dictionary</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">array</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">array</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">array</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns the item in the dictionary with the key that matches 'key' 
             * @param dictionary The dictionary to get the item from.
             * @param key The key of the item to find.
             * @return The object.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getDictionaryItemWithKey</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">dictionary</span>:<span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">key</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Object</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">item</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">dictionary</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">item</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">key</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">item</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Adds up species counts by year for all species at a site. Not currently implemented.
             * @param counts All speces counts for a site.
             * @return An array of species counts.
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getSpeciesCounts</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">counts</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span> <span class="ActionScriptComment">//adds up species counts by year for all species at a site
</span>            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">speciesCountsDict</span>:<span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Dictionary</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">count</span>:<span class="ActionScriptDefault_Text">SpeciesCount</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">counts</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//iterate through all counts - these should be sorted by site, species, year
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">speciesCountsDict</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">spcRecID</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">speciesCountsDict</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">spcRecID</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//create a new dictionary for the species
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">yearCount</span>:<span class="ActionScriptDefault_Text">SpeciesCount</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SpeciesCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//create a new count to hold the year 1 data
</span>                    <span class="ActionScriptDefault_Text">yearCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_year</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">_year</span>; <span class="ActionScriptComment">//put the year in
</span>                    <span class="ActionScriptDefault_Text">yearCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abundance</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">abundance</span>; <span class="ActionScriptComment">//and the abundance
</span>                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">speciesCountsDict</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">count</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">spcRecID</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">yearCount</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//add the count to the array for the species
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">speciesCounts</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//iterate through the dictionary to create the return array
</span>                <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">species</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">speciesCountsDict</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">siteSpeciesCount</span>:<span class="ActionScriptDefault_Text">SiteSpeciesCount</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SiteSpeciesCount</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">siteSpeciesCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">spcRecID</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">species</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">siteSpeciesCount</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">counts</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">speciesCountsDict</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">species</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ArrayCollection</span>;
                    <span class="ActionScriptDefault_Text">speciesCounts</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">siteSpeciesCount</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">speciesCounts</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Converts an array of SpcRecIDs to an inClause  
             * @param object An array collection of species IDs. 
             * @param spAttributeName
             * @return 
             * 
             */</span>            
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createSpeciesInClause</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">object</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">spAttributeName</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">inClause</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">""</span>;
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">species</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">object</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">spAttributeName</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">inClause</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">species</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">spAttributeName</span><span class="ActionScriptBracket/Brace">]</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">","</span> : <span class="ActionScriptDefault_Text">inClause</span><span class="ActionScriptOperator">+=</span><span class="ActionScriptDefault_Text">species</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">","</span>;                
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">inClause</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">substring</span><span class="ActionScriptBracket/Brace">(</span>0<span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">inClause</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">-</span>1<span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Generic error handling function for all requests to the server. 
             * @param info
             * @param token
             * 
             */</span>            
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onFault</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">info</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">Alert</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">show</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"Unable to connect to server."</span><span class="ActionScriptOperator">,</span><span class="ActionScriptString">"Critical Site Network Tool"</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getSOAPData</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">url</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">inClause</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">urlRequest</span>:<span class="ActionScriptDefault_Text">URLRequest</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">url</span><span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">url</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"?&amp;inClause="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">inClause</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">urlLoader</span>:<span class="ActionScriptDefault_Text">URLLoader</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLLoader</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">urlLoader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">COMPLETE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">complete</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">urlLoader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">load</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">complete</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
<span class="ActionScriptComment">//                var urlLoader:URLLoader=event.target as URLLoader;
</span><span class="ActionScriptComment">//                urlLoader.removeEventListener(Event.COMPLETE,complete);
</span><span class="ActionScriptComment">//                var ac:ArrayCollection=new ArrayCollection();
</span><span class="ActionScriptComment">//                var xml:XML=new XML(urlLoader.data); //create a new XML object with the returned data 
</span><span class="ActionScriptComment">//                for each (var obj:Object in xml[1].children())
</span><span class="ActionScriptComment">//                {
</span><span class="ActionScriptComment">//                    ac.addItem(obj);
</span><span class="ActionScriptComment">//                }
</span><span class="ActionScriptComment">//                dispatchEvent(new AGSResult(AGSResult.SOAPRESULT,ac));
</span>            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">}</span>
<span class="ActionScriptBracket/Brace">}</span></pre></body>
</html>
