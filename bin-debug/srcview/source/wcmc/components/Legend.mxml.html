<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>Legend.mxml</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="MXMLProcessing_Instruction">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="MXMLASDoc">&lt;!---</span><span class="MXMLASDoc">Main component that is used in the application for showing the legend items associated with the currently visible layers in the map. This component is bound to the legend items that are created by each layer.</span><span class="MXMLASDoc">--&gt;</span>
<span class="MXMLComponent_Tag">&lt;components:MyBorderContainer</span><span class="MXMLDefault_Text"> xmlns:fx="</span><span class="MXMLString">http://ns.adobe.com/mxml/2009</span><span class="MXMLDefault_Text">" 
                   xmlns:s="</span><span class="MXMLString">library://ns.adobe.com/flex/spark</span><span class="MXMLDefault_Text">" 
                   xmlns:mx="</span><span class="MXMLString">library://ns.adobe.com/flex/mx</span><span class="MXMLDefault_Text">" bottom="</span><span class="MXMLString">95</span><span class="MXMLDefault_Text">" left="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" minHeight="</span><span class="MXMLString">0</span><span class="MXMLDefault_Text">" minWidth="</span><span class="MXMLString">0</span><span class="MXMLDefault_Text">" styleName="</span><span class="MXMLString">InformationPanel</span><span class="MXMLDefault_Text">" xmlns:supportClasses="</span><span class="MXMLString">com.esri.ags.components.supportClasses.*</span><span class="MXMLDefault_Text">" xmlns:components="</span><span class="MXMLString">wcmc.components.*</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">&gt;</span>
    <span class="MXMLComponent_Tag">&lt;s:BorderContainer</span><span class="MXMLDefault_Text"> styleName="</span><span class="MXMLString">ContentPanel</span><span class="MXMLDefault_Text">" right="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" bottom="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" top="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" left="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" minHeight="</span><span class="MXMLString">0</span><span class="MXMLDefault_Text">" minWidth="</span><span class="MXMLString">0</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">&gt;</span>
        <span class="MXMLComponent_Tag">&lt;s:VGroup</span><span class="MXMLDefault_Text"> paddingBottom="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" paddingLeft="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" paddingRight="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" paddingTop="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" gap="</span><span class="MXMLString">1</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">&gt;</span>
            <span class="MXMLComponent_Tag">&lt;components:BoxHeader</span><span class="MXMLDefault_Text"> dragComponent="</span><span class="MXMLString">{</span><span class="ActionScriptReserved">this</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" target="</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">csn</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" caption="</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT59'</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" paddingBottom="</span><span class="MXMLString">6</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>            
            <span class="MXMLComponent_Tag">&lt;s:List</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">layerLegendsList</span><span class="MXMLDefault_Text">" itemRenderer="</span><span class="MXMLString">wcmc.renderers.LayerLegendRenderer</span><span class="MXMLDefault_Text">" skinClass="</span><span class="MXMLString">wcmc.skins.LayerLegendSkin</span><span class="MXMLDefault_Text">" dataProvider="</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">layerLegends</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" enabled="</span><span class="MXMLString">false</span><span class="MXMLDefault_Text">" styleName="</span><span class="MXMLString">layerLegendItem</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>
        <span class="MXMLComponent_Tag">&lt;/s:VGroup&gt;</span>
        <span class="MXMLSpecial_Tag">&lt;fx:Script&gt;</span>
            &lt;![CDATA[
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Map</span>;
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LayerEvent</span>;
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MapEvent</span>;
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Layer</span>;
                
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">collections</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ArrayCollection</span>;
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FlexEvent</span>;
                
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ILegend</span>;
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LayerLegend</span>;
                <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SymbologyChangedEvent</span>;
                <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span>
                <span class="ActionScriptASDoc">/**
                 * ArrayCollection of the layer legend objects. Each layer legend object represents the symbology and captions from a single layer.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerLegends</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_map</span>:<span class="ActionScriptDefault_Text">Map</span>;
                <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">csn</span>:<span class="ActionScriptDefault_Text">CSN</span>;
                <span class="ActionScriptASDoc">/**
                 * Reference to the map object in the main application file. When this object is set, listeners are added so that when layers are added or removed from the map, their legend items are bound or unbound to the legend. 
                 */</span> 
                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">set</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">value</span>:<span class="ActionScriptDefault_Text">Map</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">_map</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">value</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//layers may already be present in the map - those that do no include the 'includeIn' mxml in their declaration - so add the listeners for these as well
</span>                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layers</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ILegend</span><span class="ActionScriptBracket/Brace">)</span>
                            <span class="ActionScriptBracket/Brace">{</span>
                                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">iLegend</span>:<span class="ActionScriptDefault_Text">ILegend</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layer</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ILegend</span>;
                                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">showLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">addLayerListeners</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;    
                            <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LAYER_ADD</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">layerAdd</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//whenever layers are added to the map they need to have a listener added to their symbologyChanged event 
</span>                    <span class="ActionScriptDefault_Text">value</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">MapEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LAYER_REMOVE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">removeLayerListeners</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//whenever layers are added to the map they need to have a listener added to their symbologyChanged event 
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">public</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptReserved">get</span> <span class="ActionScriptDefault_Text">map</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Map</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_map</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Called when a layer is added. Listeners are added to the added layer to respond to layer refreshes and symbology changes.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">layerAdd</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MapEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">addLayerListeners</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Adds layer listeners to layers that are already present on the map. Update start, symbology changes and remove from map events are listened for.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">addLayerListeners</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">LayerEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">UPDATE_START</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">updateStart</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SymbologyChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SYMBOLOGYCHANGED</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">symbologyChanged</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FlexEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">HIDE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">removeLayerLegend</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//when the layer is hidden then it is removed from the layerLegends array collection
</span>                    <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">REMOVED_FROM_STAGE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">removeLayerLegend</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//when the state changes the layer is removed from the stage - so remove the legend
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Removes the symbology changed listener.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeLayerListeners</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">MapEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SymbologyChangedEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SYMBOLOGYCHANGED</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">symbologyChanged</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Called when symbols have changed as the result of either a layer refresh or change in renderer
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">symbologyChanged</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Layer</span>;
                    <span class="ActionScriptDefault_Text">updateLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">false</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//update the legend
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Called when a layer update start event is dispatched - this function updates the legend.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateStart</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">LayerEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">updateLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">,</span><span class="ActionScriptReserved">true</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Updates the legend items by rebuilding the LayerLegend array.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">updateLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">isLoading</span>:<span class="ActionScriptDefault_Text">Boolean</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">visible</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptOperator">||</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isInScaleRange</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">iLegend</span>:<span class="ActionScriptDefault_Text">ILegend</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getILegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">iLegend</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">removeExistingLayerLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//remove the existing layer legend - DATA BINDING DID NOT WORK USING AN EXISTING LEGEND
</span>                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerLegend</span>:<span class="ActionScriptDefault_Text">LayerLegend</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">createLayerLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">layerLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">caption</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">iLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">caption</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//set the caption of the layer legend
</span>                        <span class="ActionScriptDefault_Text">layerLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">items</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">iLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">items</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get the legend items
</span>                        <span class="ActionScriptDefault_Text">layerLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">loading</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">isLoading</span>; <span class="ActionScriptComment">//set the loading flag - this is used in the item renderer to show the loading icon
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Creates a layer legend for the passed layer. The layer legend is placed in the legend int he same position it is placed on the map.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">createLayerLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">LayerLegend</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerLegend</span>:<span class="ActionScriptDefault_Text">LayerLegend</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">LayerLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//create a new layer legend
</span>                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">position</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getAddPosition</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get the position to add the layer at in the legend
</span>                    <span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItemAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerLegend</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">position</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//add the layer legend to the legend
</span>                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">layerLegend</span>;                    
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Returns an ILegend iterface to a layer if it supports it
                 */</span>
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getILegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ILegend</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">layer</span> <span class="ActionScriptReserved">is</span> <span class="ActionScriptDefault_Text">ILegend</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">iLegend</span>:<span class="ActionScriptDefault_Text">ILegend</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layer</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">ILegend</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">iLegend</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">iLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">showLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">iLegend</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Gets the layer legend for the passed layer
                 */</span>
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getLayerLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">LayerLegend</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_layerLegend</span>:<span class="ActionScriptDefault_Text">LayerLegend</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layerLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_layerLegend</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Removes a layer legend from the LayerLegends ArrayCollection.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeLayerLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">i</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span>0;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">&lt;</span><span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span>;<span class="ActionScriptDefault_Text">i</span><span class="ActionScriptOperator">++</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerLegend</span>:<span class="ActionScriptDefault_Text">LayerLegend</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">]</span>;
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeItemAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">i</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Removes a layer legend from the LayerLegends ArrayCollection.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">removeExistingLayerLegend</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_layerLegend</span>:<span class="ActionScriptDefault_Text">LayerLegend</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layerLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeItemAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getItemIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layerLegend</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Returns the index position to add the layer at in the legend - this depends on where the layer is in relation to the other layers on the map.  
                 */</span>
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getAddPosition</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">layerPosition</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getLayerPosition</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">childPositions</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_layerLegend</span>:<span class="ActionScriptDefault_Text">LayerLegend</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">layerLegends</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">childPositions</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">getLayerPosition</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_layerLegend</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">childPositions</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">return</span> 0;
                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">childPositions</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">push</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerPosition</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">childPositions</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">sort</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">childPositions</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">indexOf</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layerPosition</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptASDoc">/**
                 * Returns the layer position in the map.
                 */</span> 
                <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getLayerPosition</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span>:<span class="ActionScriptDefault_Text">Layer</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">Number</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">parent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getChildIndex</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">layer</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;</span>
        <span class="MXMLSpecial_Tag">&lt;/fx:Script&gt;</span>
    <span class="MXMLComponent_Tag">&lt;/s:BorderContainer&gt;</span>
<span class="MXMLComponent_Tag">&lt;/components:MyBorderContainer&gt;</span></pre></body>
</html>
