<!-- saved from url=(0014)about:internet -->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
<title>SiteSearchBox.mxml</title>
<link rel="stylesheet" type="text/css" href="../../../SourceStyles.css"/>
</head>

<body><pre><span class="MXMLProcessing_Instruction">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span>
<span class="MXMLASDoc">&lt;!---</span><span class="MXMLASDoc">
The SiteSearchBox is an MXML component that is used in the CSN tool to search for a site. 
&lt;p&gt;The life cycle of the SiteSearchBox is the following:&lt;/p&gt;
&lt;ol&gt;
&lt;li&gt;The page is loaded and a query is run on initialisation to load a batch of records.&lt;/li&gt;
&lt;li&gt;The user enters search text in the box and a query is run to get the matching records.&lt;/li&gt;
&lt;li&gt;The list is populated with the matching items.&lt;/li&gt;
&lt;li&gt;If a filter is applied, then the filtered results are queried and populated in the list.&lt;/li&gt;
&lt;/ol&gt;
</span><span class="MXMLASDoc">--&gt;</span>
<span class="MXMLComponent_Tag">&lt;s:Group</span><span class="MXMLDefault_Text"> xmlns:fx="</span><span class="MXMLString">http://ns.adobe.com/mxml/2009</span><span class="MXMLDefault_Text">" 
         xmlns:s="</span><span class="MXMLString">library://ns.adobe.com/flex/spark</span><span class="MXMLDefault_Text">" 
         xmlns:mx="</span><span class="MXMLString">library://ns.adobe.com/flex/mx</span><span class="MXMLDefault_Text">"
         xmlns:classes="</span><span class="MXMLString">wcmc.classes.*</span><span class="MXMLDefault_Text">"
         xmlns:components="</span><span class="MXMLString">wcmc.components.*</span><span class="MXMLDefault_Text">" 
         xmlns:esri="</span><span class="MXMLString">http://www.esri.com/2008/ags</span><span class="MXMLDefault_Text">"
         width="</span><span class="MXMLString">100%</span><span class="MXMLDefault_Text">" height="</span><span class="MXMLString">100%</span><span class="MXMLDefault_Text">" 
         initialize="</span><span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLDefault_Text">"
         creationComplete="</span><span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setFocus</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">&gt;</span>
    <span class="MXMLComponent_Tag">&lt;s:layout&gt;</span>
        <span class="MXMLComponent_Tag">&lt;s:VerticalLayout/&gt;</span>
    <span class="MXMLComponent_Tag">&lt;/s:layout&gt;</span>
    
    <span class="MXMLSpecial_Tag">&lt;fx:Declarations&gt;</span>
        <span class="MXMLASDoc">&lt;!---</span><span class="MXMLASDoc">The locator is a geolocation service that ESRI provide to locate geographic places in the world.</span><span class="MXMLASDoc">--&gt;</span>
        <span class="MXMLComponent_Tag">&lt;esri:Locator</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">locator</span><span class="MXMLDefault_Text">" url="</span><span class="MXMLString">http://tasks.arcgisonline.com/ArcGIS/rest/services/Locators/ESRI_Places_World/GeocodeServer</span><span class="MXMLDefault_Text">" showBusyCursor="</span><span class="MXMLString">true</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>
        <span class="MXMLComponent_Tag">&lt;classes:FilterCollection</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">countryFilterCollection</span><span class="MXMLDefault_Text">" masterTableName="</span><span class="MXMLString">V_FILTER</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">&gt;</span>
            <span class="MXMLComponent_Tag">&lt;classes:filters&gt;</span>
                <span class="MXMLComponent_Tag">&lt;s:ArrayCollection&gt;</span>
                    <span class="MXMLComponent_Tag">&lt;classes:Filter</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">countryFilter</span><span class="MXMLDefault_Text">" label="</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT28'</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" table="</span><span class="MXMLString">V_COUNTRY</span><span class="MXMLDefault_Text">" valueField="</span><span class="MXMLString">Name</span><span class="MXMLDefault_Text">" masterTableFilterFieldName="</span><span class="MXMLString">SiteRecID</span><span class="MXMLDefault_Text">" filterRenderer="</span><span class="MXMLString">wcmc.renderers.CountryFilterRenderer</span><span class="MXMLDefault_Text">" sortLookupValues="</span><span class="MXMLString">false</span><span class="MXMLDefault_Text">" sharedObjectName="</span><span class="MXMLString">siteSearchFilter</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>
                <span class="MXMLComponent_Tag">&lt;/s:ArrayCollection&gt;</span>
            <span class="MXMLComponent_Tag">&lt;/classes:filters&gt;</span>
        <span class="MXMLComponent_Tag">&lt;/classes:FilterCollection&gt;</span>
    <span class="MXMLSpecial_Tag">&lt;/fx:Declarations&gt;</span>
    
    <span class="MXMLComponent_Tag">&lt;s:HGroup</span><span class="MXMLDefault_Text"> width="</span><span class="MXMLString">100%</span><span class="MXMLDefault_Text">" verticalAlign="</span><span class="MXMLString">middle</span><span class="MXMLDefault_Text">" paddingTop="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">" paddingBottom="</span><span class="MXMLString">5</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">&gt;</span>
        <span class="MXMLComponent_Tag">&lt;s:Label</span><span class="MXMLDefault_Text"> text="</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT14'</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" styleName="</span><span class="MXMLString">speciesSearchBox</span><span class="MXMLDefault_Text">" </span><span class="MXMLComponent_Tag">/&gt;</span>
        <span class="MXMLComponent_Tag">&lt;classes:SearchBox</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">searchBox</span><span class="MXMLDefault_Text">" keyUp="</span><span class="ActionScriptDefault_Text">searchBox_keyUpHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>
        <span class="MXMLComponent_Tag">&lt;components:FilterUI2</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">countryFilterUI</span><span class="MXMLDefault_Text">" filter="</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">countryFilter</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" openSide="</span><span class="MXMLString">left</span><span class="MXMLDefault_Text">" buttonTooltip="</span><span class="MXMLString">{</span><span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT95'</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLString">}</span><span class="MXMLDefault_Text">" initialize="</span><span class="ActionScriptDefault_Text">countryFilterUI_initializeHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>
        <span class="MXMLComponent_Tag">&lt;mx:Image</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">filterImage</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>
    <span class="MXMLComponent_Tag">&lt;/s:HGroup&gt;</span>
    <span class="MXMLComponent_Tag">&lt;mx:List</span><span class="MXMLDefault_Text"> id="</span><span class="MXMLString">matchingList</span><span class="MXMLDefault_Text">" itemRenderer="</span><span class="MXMLString">wcmc.renderers.SiteListRenderer</span><span class="MXMLDefault_Text">" itemClick="</span><span class="ActionScriptDefault_Text">matchingList_itemClickHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptBracket/Brace">)</span><span class="MXMLDefault_Text">" width="</span><span class="MXMLString">100%</span><span class="MXMLDefault_Text">" height="</span><span class="MXMLString">100%</span><span class="MXMLDefault_Text">" rowHeight="</span><span class="MXMLString">24</span><span class="MXMLDefault_Text">"</span><span class="MXMLComponent_Tag">/&gt;</span>
    
    <span class="MXMLSpecial_Tag">&lt;fx:Script&gt;</span>
        &lt;![CDATA[
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Geometry</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geometry</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">MapPoint</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">tasks</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">supportClasses</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AddressCandidate</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">com</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">esri</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ags</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">utils</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">WebMercatorUtil</span>;
            
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">collections</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ArrayCollection</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FlexEvent</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ListEvent</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">events</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">ToolTipEvent</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">managers</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">CursorManager</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">mx</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">rpc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">AsyncResponder</span>;
            
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Countries</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FilterResultCompleteEvent</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">LookupValue</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SetSiteEvent</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Site</span>;
            <span class="ActionScriptReserved">import</span> <span class="ActionScriptDefault_Text">wcmc</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">classes</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">Utilities</span>;
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">searchText</span>:<span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptReserved">private</span> <span class="ActionScriptReserved">const</span> <span class="ActionScriptDefault_Text">RECORDSIZE</span>:<span class="ActionScriptDefault_Text">int</span><span class="ActionScriptOperator">=</span>200;
            <span class="ActionScriptASDoc">/**
             * The siteIDs of the matching sites shown in the list box.
             */</span> 
            <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">matchingSiteRecIDs</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span>;
            <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptMetadata">Bindable</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">csn</span>:<span class="ActionScriptDefault_Text">CSN</span>;
            <span class="ActionScriptASDoc">/**
             * The siteIDs of the matching sites shown in the list box as a string.
             */</span> 
            <span class="ActionScriptReserved">public</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">siteRecIDsString</span>:<span class="ActionScriptDefault_Text">String</span>;
            <span class="ActionScriptASDoc">/**
             * The urlRequest object that is used to retrieve the sites data from the server 
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">urlRequest</span>:<span class="ActionScriptDefault_Text">URLRequest</span>;
            <span class="ActionScriptASDoc">/**
             * The urlLoader object that is used to retrieve the site data from the server 
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">urlLoader</span>:<span class="ActionScriptDefault_Text">URLLoader</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLLoader</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptASDoc">/**
             * Called on initialisation this function adds the keyDown event listener and populates the list box with the first 200 sites. 
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">init</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">addEventListener</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">KEY_DOWN</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">keyDown</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">populateSiteListBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Handles a key up event on the keyboard. If the CR key is pressed and there is only one item in the list of sites, then this site is selected and the site page for that site is loaded. &lt;p&gt;If it is not a CR key then the site list is queried for the matching text string.&lt;/p&gt;
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">searchBox_keyUpHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">charCode</span><span class="ActionScriptOperator">==</span>13<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//CR pressed
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dataProvider</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">==</span>1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptDefault_Text">selectSite</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">searchText</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span>;
                    <span class="ActionScriptDefault_Text">populateSiteListBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Gets the selected site as a Site object and dispatches the SetSiteEvent to change the applications state.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">selectSite</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">site</span>:<span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedItem</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Site</span>;
                <span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">SetSiteEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">SetSiteEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">SETSITE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedItem</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Loads the records into the list box
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">populateSiteListBox</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">loadRecords</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">startindex</span>:0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">size</span>:<span class="ActionScriptDefault_Text">RECORDSIZE</span><span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Requests the site data from the server according to whether the search text is entered and whether the sites are filtered by country.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">loadRecords</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">obj</span>:<span class="ActionScriptDefault_Text">Object</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">urlLoader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">COMPLETE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">dataLoaded</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//add the listener for when the data is loaded
</span>                <span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">setBusyCursor</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; 
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptOperator">!</span><span class="ActionScriptDefault_Text">searchText</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//if there is no search text
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">siteRecIDsString</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//if a country filter has been set
</span>                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/CSN_WebServices/DataServices.asmx/GetSitesInClause"</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">URLRequestMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">POST</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLVariables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"inClause="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">siteRecIDsString</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get the sites with the matching inClause
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span> <span class="ActionScriptComment">//no country filter set
</span>                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">urlRequest</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/CSN_WebServices/DataServices.asmx/GetSites"</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">URLRequestMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">POST</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLVariables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"startIndex="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">startindex</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"&amp;pageSize="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">size</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get all sites
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span> <span class="ActionScriptComment">//search text has been set
</span>                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">siteRecIDsString</span><span class="ActionScriptOperator">!=</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptComment">//if a country filter has been set
</span>                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">urlRequest</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/CSN_WebServices/DataServices.asmx/GetSitesSearchInClause"</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">URLRequestMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">POST</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLVariables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"searchText="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">searchText</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"&amp;inClause="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">siteRecIDsString</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get the sites with the matching inClause and search text
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptReserved">else</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptDefault_Text">urlRequest</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLRequest</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"http://dev.unep-wcmc.org/CSN_WebServices/DataServices.asmx/GetSitesSearch"</span><span class="ActionScriptBracket/Brace">)</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">method</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">URLRequestMethod</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">POST</span>;
                        <span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">URLVariables</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">"searchText="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">searchText</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"&amp;startIndex="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">startindex</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"&amp;pageSize="</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">obj</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">size</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get all the sites with the matching search text
</span>                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">urlLoader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">load</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">urlRequest</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//execute the request
</span>            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Asynchronous function called when the data is loaded. 
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">dataLoaded</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">urlLoader</span>:<span class="ActionScriptDefault_Text">URLLoader</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">target</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">URLLoader</span>;
                <span class="ActionScriptDefault_Text">urlLoader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">Event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">COMPLETE</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">dataLoaded</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_xml</span>:<span class="ActionScriptDefault_Text">XML</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Utilities</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getSOAPXML</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">urlLoader</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">data</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_xml</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">populateSiteArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_xml</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">children</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dataProvider</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">_ac</span>;
                    <span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toolTip</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">""</span>;
                    <span class="ActionScriptReserved">switch</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dataProvider</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">case</span> 1:
                            <span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedIndex</span><span class="ActionScriptOperator">=</span>0;
                            <span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toolTip</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT96'</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//if there is only one matching site, then show a tooltip that you can just press enter to select the site
</span>                            <span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ToolTipEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ToolTipEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TOOL_TIP_SHOW</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//show the tooltip
</span>                            <span class="ActionScriptReserved">break</span>;
                        <span class="ActionScriptReserved">default</span>:
                            <span class="ActionScriptReserved">break</span>;
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">else</span>
                <span class="ActionScriptBracket/Brace">{</span> <span class="ActionScriptComment">//no matching sites
</span>                    <span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dataProvider</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>; <span class="ActionScriptComment">//clear the matching site list
</span>                    <span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toolTip</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT97'</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">" '"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptString">"'.\n"</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT98'</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//show a tooltip that explains the geoprocessing tool
</span>                    <span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dispatchEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ToolTipEvent</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">ToolTipEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">TOOL_TIP_SHOW</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//show the tooltip
</span>                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptDefault_Text">CursorManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">removeAllCursors</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//removeBusyCursor didnt work - I think because lots of setBusy cursors were set when adding search terms
</span>            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Populates the matching sites as a set of strongly typed objects.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">populateSiteArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_XMLList</span>:<span class="ActionScriptDefault_Text">XMLList</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_ac</span>:<span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">ArrayCollection</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">_xml</span>:<span class="ActionScriptDefault_Text">XML</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">_XMLList</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">site</span>:<span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">Site</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">siteRecID</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_xml</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">a</span>;
                    <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">name</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_xml</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">b</span>;
                    <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">countryCode</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">_xml</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">c</span>;
                    <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isPoly</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_xml</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">d</span><span class="ActionScriptOperator">==</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">site</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">isIBA</span><span class="ActionScriptOperator">=</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">_xml</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">e</span><span class="ActionScriptOperator">==</span>1<span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">_ac</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addItem</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">site</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">_ac</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Select the site.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">matchingList_itemClickHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">ListEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">selectSite</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedIndex</span><span class="ActionScriptOperator">=</span>-1;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Searches the place name in ESRIs geocoder.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">doGeocode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span> 
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myAddress</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">PlaceName</span>:<span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span><span class="ActionScriptBracket/Brace">}</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">myOutFields</span>:<span class="ActionScriptDefault_Text">Array</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptBracket/Brace">[</span><span class="ActionScriptString">"*"</span><span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptDefault_Text">locator</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addressToLocations</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">myAddress</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">myOutFields</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">new</span> <span class="ActionScriptDefault_Text">AsyncResponder</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">onGeocodeResult</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Asynchronous function called when the geocoder completes.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">onGeocodeResult</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">candidates</span>:<span class="ActionScriptDefault_Text">Array</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">token</span>:<span class="ActionScriptDefault_Text">Object</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">candidates</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span> <span class="ActionScriptOperator">&gt;</span> 0<span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">addressCandidate</span>:<span class="ActionScriptDefault_Text">AddressCandidate</span> <span class="ActionScriptOperator">=</span> <span class="ActionScriptDefault_Text">candidates</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                    <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">geometry</span>:<span class="ActionScriptDefault_Text">Geometry</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">WebMercatorUtil</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">geographicToWebMercator</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">addressCandidate</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">location</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//get the geometry for the first matching location
</span>                    <span class="ActionScriptDefault_Text">csn</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">centerAt</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">geometry</span> <span class="ActionScriptReserved">as</span> <span class="ActionScriptDefault_Text">MapPoint</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//move to that location
</span>                    <span class="ActionScriptDefault_Text">csn</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">map</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">level</span> <span class="ActionScriptOperator">=</span> 12; <span class="ActionScriptComment">//set the zoom level
</span>                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * If the user presses a key the first step is to see if they want to geocode.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">keyDown</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">KeyboardEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">charCode</span> <span class="ActionScriptOperator">!=</span> 0<span class="ActionScriptBracket/Brace">)</span> 
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">charCode</span> <span class="ActionScriptOperator">==</span> 13<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">&amp;&amp;</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">searchBox</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">text</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">&gt;</span>0<span class="ActionScriptBracket/Brace">)</span><span class="ActionScriptBracket/Brace">)</span>
                    <span class="ActionScriptBracket/Brace">{</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dataProvider</span><span class="ActionScriptOperator">==</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">doGeocode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptReserved">return</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dataProvider</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">==</span>0<span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">doGeocode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptReserved">return</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                        <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matchingList</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">dataProvider</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">==</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span>
                        <span class="ActionScriptBracket/Brace">{</span>
                            <span class="ActionScriptDefault_Text">doGeocode</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                            <span class="ActionScriptReserved">return</span>;
                        <span class="ActionScriptBracket/Brace">}</span>
                    <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span> 
            <span class="ActionScriptASDoc">/**
             * Populates the country filter with all of the countres and adds a listener for when the filter is changed.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">countryFilterUI_initializeHandler</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">FlexEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">countryFilterCollection</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getMatchingIDs</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptDefault_Text">countryFilterCollection</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">addEventListener</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">FilterResultCompleteEvent</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">FILTERRESULTCOMPLETE</span><span class="ActionScriptOperator">,</span><span class="ActionScriptDefault_Text">sitesFiltered</span><span class="ActionScriptBracket/Brace">)</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Asynchronous function called when the filtered sites are returned.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">sitesFiltered</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">event</span>:<span class="ActionScriptDefault_Text">FilterResultCompleteEvent</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">matchingSiteRecIDs</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">event</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">filterResult</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">matchingIDs</span>; <span class="ActionScriptComment">//get the filtered site IDs
</span>                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">countryFilter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedItems</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">length</span><span class="ActionScriptOperator">==</span>1<span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">setFlag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">clearFlag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//if there is only one country selected then show the country flag
</span>                <span class="ActionScriptDefault_Text">siteRecIDsString</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Utilities</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">arrayCollectionToString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">matchingSiteRecIDs</span><span class="ActionScriptBracket/Brace">)</span>; <span class="ActionScriptComment">//create the siteRecIDs as a string
</span>                <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">siteRecIDsString</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">?</span> <span class="ActionScriptDefault_Text">loadRecords</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptReserved">null</span><span class="ActionScriptBracket/Brace">)</span> : <span class="ActionScriptDefault_Text">loadRecords</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">{</span><span class="ActionScriptDefault_Text">startindex</span>:0<span class="ActionScriptOperator">,</span> <span class="ActionScriptDefault_Text">size</span>:<span class="ActionScriptDefault_Text">RECORDSIZE</span><span class="ActionScriptBracket/Brace">}</span><span class="ActionScriptBracket/Brace">)</span>; 
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * If a single country is selected in the country filter then show this countries flag
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">setFlag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">selectedId</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">countryFilter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">selectedItems</span><span class="ActionScriptBracket/Brace">[</span>0<span class="ActionScriptBracket/Brace">]</span>;
                <span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">countryName</span>:<span class="ActionScriptDefault_Text">String</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">getCountryName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectedId</span><span class="ActionScriptBracket/Brace">)</span>;
                <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">countryName</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptDefault_Text">filterImage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">Countries</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getCountryFlag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">countryName</span><span class="ActionScriptBracket/Brace">)</span>;
                    <span class="ActionScriptDefault_Text">filterImage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toolTip</span><span class="ActionScriptOperator">=</span><span class="ActionScriptDefault_Text">resourceManager</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">getString</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptString">'myResources'</span><span class="ActionScriptOperator">,</span> <span class="ActionScriptString">'TEXT99'</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptOperator">+</span> <span class="ActionScriptDefault_Text">countryName</span>;
                <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Returns the country name from the selected value in the country filter.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">getCountryName</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">selectedValue</span>:<span class="ActionScriptDefault_Text">Number</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptDefault_Text">String</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptReserved">for each</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptvar">var</span> <span class="ActionScriptDefault_Text">lu</span>:<span class="ActionScriptDefault_Text">LookupValue</span> <span class="ActionScriptReserved">in</span> <span class="ActionScriptDefault_Text">countryFilter</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">lookupValues</span><span class="ActionScriptBracket/Brace">)</span>
                <span class="ActionScriptBracket/Brace">{</span>
                    <span class="ActionScriptReserved">if</span> <span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptDefault_Text">lu</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">id</span><span class="ActionScriptOperator">==</span><span class="ActionScriptDefault_Text">selectedValue</span><span class="ActionScriptBracket/Brace">)</span> <span class="ActionScriptReserved">return</span> <span class="ActionScriptDefault_Text">lu</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">value</span>;
                <span class="ActionScriptBracket/Brace">}</span>
                <span class="ActionScriptReserved">return</span> <span class="ActionScriptReserved">null</span>;
            <span class="ActionScriptBracket/Brace">}</span>
            <span class="ActionScriptASDoc">/**
             * Clears the flag if more than one country is selected.
             */</span> 
            <span class="ActionScriptReserved">protected</span> <span class="ActionScriptfunction">function</span> <span class="ActionScriptDefault_Text">clearFlag</span><span class="ActionScriptBracket/Brace">(</span><span class="ActionScriptBracket/Brace">)</span>:<span class="ActionScriptReserved">void</span>
            <span class="ActionScriptBracket/Brace">{</span>
                <span class="ActionScriptDefault_Text">filterImage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">source</span><span class="ActionScriptOperator">=</span><span class="ActionScriptReserved">null</span>;
                <span class="ActionScriptDefault_Text">filterImage</span><span class="ActionScriptOperator">.</span><span class="ActionScriptDefault_Text">toolTip</span><span class="ActionScriptOperator">=</span><span class="ActionScriptString">""</span>;
            <span class="ActionScriptBracket/Brace">}</span>
        <span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptBracket/Brace">]</span><span class="ActionScriptOperator">&gt;</span>
    <span class="MXMLSpecial_Tag">&lt;/fx:Script&gt;</span>
    
<span class="MXMLComponent_Tag">&lt;/s:Group&gt;</span></pre></body>
</html>
